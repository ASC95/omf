<head>
	<title>Open Modeling Framework</title>
	<meta charset='utf-8'>
	<link type='text/css' rel='stylesheet' href='../static/omf.css' />
	<link rel='shortcut icon' href='{{ url_for("static", filename="favicon.ico") }}'>
	<style>
		table.studyOptions, table.analysisOptions, table.reportOptions {width:70%; text-align:left; margin-left:auto;}
		#studyList > div {margin-bottom:0px;}
		#studyList > div + div {margin-top:0px; margin-bottom:0px; border-top:none;} 
		#reportList > div {margin-bottom:0px;}
		#reportList > div + div {margin-top:0px; margin-bottom:0px; border-top:none;} 
		button {width:auto; padding:4px 6px 4px; float:right;}
		.buttonGroup {float:none;}
		a#addReport {float:right;}
		a.removeStudyReport {float:left;}
		select.feederName {width:70%;}
		input.radio {margin-left:10px;}
	</style>
	<script src='../static/omf.js'></script>
	<script>
		reportList = {{ reportList | safe }}
		var studyReportId = 0
		studyHTML = "<div id='removalId' class='content'><a href='javascript:removeStudyReport(removalId)' class='removeStudyReport'>✖</a><table class='studyOptions'><tr><td>Study Name</td><td><input type='text' class='studyName'/></td></tr><tr><td>Feeder</td><td><select class='feederName'>{% for feeder in feeders %}<option value='{{ feeder }}'>{{ feeder }}</option>{% endfor %}</select><button onclick='window.location=\"../model/\"+this.parentNode.querySelector(\".feederName\").value'>Edit Selected Feeder</button></td></tr><tr><td>Location</td><td><select class='tmy2name'>{% for tmy2 in tmy2s %}<option value='{{ tmy2 }}'>{{ tmy2 }}</option>{% endfor %}</select></td></tr></table></div>"
		function addStudy() {
			gebi('studyList').innerHTML += studyHTML.replace(/removalId/g,studyReportId)
			studyReportId += 1
		}
		function removeStudyReport(x) {
			gebi(x).parentNode.removeChild(gebi(x))
		}
		function saveAnalysis() {
			responseDict = {}
			// Get the analysis-level stuff.
			responseDict.simLength = parseInt(gebi('simLength').value)
			responseDict.simLengthUnits = getRadioSetting('radio')
			responseDict.simStartDate = gebi('simStartDate').value
			responseDict.analysisName = gebi('analysisName').value
			// Get the study-level stuff.
			studyList = []
			studyDivs = document.getElementsByClassName('studyOptions')
			for (i=0; i<studyDivs.length; i++) {
				study = {}
				study.studyName = studyDivs[i].querySelector('.studyName').value
				study.feederName = studyDivs[i].querySelector('.feederName').value
				study.tmy2name = studyDivs[i].querySelector('.tmy2name').value
				study.studyType = 'gridLab'
				studyList.push(study)
			}
			responseDict.studies = studyList
			// Get the reports.
			reportList = []
			reportDivs = document.getElementsByClassName('reportOptions')
			for (i=0; i<reportDivs.length; i++) {
				report = {}
				report.reportType = reportDivs[i].querySelector('.reportName').innerHTML
				reportList.push(report)
			}
			responseDict.reports = reportList
			// Send the request.
			post_to_url('/saveAnalysis/', {'json':JSON.stringify(responseDict)})
		}
		function addReport(reportName) {
			// Don't let the user add more than one copy of the report:
			if (document.getElementsByClassName(reportName).length == 1) {return false}
			reportStatsHTML = "<div id='REMOVALID' class='content REPORTNAME'><a href='javascript:removeStudyReport(REMOVALID)' class='removeStudyReport'>✖</a><table class='reportOptions'><tr><td>Report Name</td><td class='reportName'>REPORTNAME</td></tr></table></div>"
			gebi('reportList').innerHTML += reportStatsHTML.replace(/REMOVALID/g,studyReportId).replace(/REPORTNAME/g,reportName)
			studyReportId += 1
		}
	</script>
</head>
<body>
	<div id='title'>
		<div id='logoBox'><a href='/'>▦</a></div>
		<!--Title:-->Analysis Creation
	</div>
	<div class='content'>
		<div class='buttonGroup'>
			<button class='pill' onclick='dropPill(this, "Add Study")'>Add Study ▾</button>
			<ul class='menu'>
				<li><a href='javascript:addStudy()'>Gridlab</a></li>
			</ul>
		</div>		
		<div class='buttonGroup'>
			<button class='pill' onclick='dropPill(this, "Add Report")'>Add Report ▾</button>
			<ul class='menu'>
				{% for rep in reportList %}
				<li><a href='javascript:addReport("{{rep}}")'>{{ rep }}</a></li>
				{% endfor %}
			</ul>
		</div>
	</div>
	<div id='studyList'></div>
	<div id='reportList'></div>
	<div class='content'>
		<table class='analysisOptions'>
			<tr>
				<td>Analysis Name</td><td><input type='text' id='analysisName'/></td>
			</tr>
			<tr>
				<td>Simulation Length</td><td><input type='text' id='simLength'/></td>
			</tr>
			<tr>
				<td></td><td><input type='radio' class='radio' name='simLengthUnits' value='minutes'/> Minutes <input type='radio' class='radio' name='simLengthUnits' value='hours'/> Hours <input type='radio' class='radio' name='simLengthUnits' value='days'/> Days </td></tr>
			<tr>
				<td>Simulation Start Date (YYYY-MM-DD)</td><td><input type='text' id='simStartDate'/></td>
			</tr>
			<tr>
				<td></td><td><button onclick='javascript:saveAnalysis()'>Save Analysis</button></td>
			</tr>
		</table>
	</div>
</body>
