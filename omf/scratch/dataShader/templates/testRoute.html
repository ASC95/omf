<head>
	<script src="https://ajax.googleapis.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
</head>
<style type="text/css">

body, html {
    width: 100%;
    height: 100%;
    margin: 0;
    padding: 0;
    overflow: hidden;
}

#imageCanvas {
	width: 100%;
	height: 100%;
	position: absolute;
}

.img{
	position:absolute;
	z-index:-1;
	width: 100%;
	height: 100%;
}

#controller{
	background-color: coral;
	position:absolute;
	z-index: 1;
}
label, input {
	display: block;
}

.strafeArrow{
	opacity: 1;
}

#strafeLeft {
	position: absolute;
	height: 25%;
	top:50%;
	left: 0;
	-webkit-transform: translate(0%, -50%);
	-ms-transform: translate(0%, -50%);
	transform: translate(0%, -50%);
}
#strafeRight {
	position: absolute;
	height: 25%;
	top: 50%;
	right: 0;
	-webkit-transform: translate(0%, -50%);
	-ms-transform: translate(0%, -50%);
	transform: translate(0%, -50%);
}
#strafeBottom {
	position: absolute;
	left: 50%;
	bottom: 0;
	-ms-transform: translate(-50%, 0);
	-webkit-transform: translate(-50%, 0);
	transform: translate(-50%, 0);
	width: 25%;
}
#strafeTop {
	position: absolute;
	left: 50%;
	top: 0;
	-ms-transform: translate(-50%, 0);
	-webkit-transform: translate(-50%, 0);
	transform: translate(-50%, 0);
	width: 25%;
}

</style>
<body>
	<div id="canDiv">
		<img class='img' id="dsImage" src="{{newImage}}" alt="" />
		<canvas id="imageCanvas" height="900" width="1900" >
		</canvas>
	<div id="controller">
		<form name="inputForm" id="inputForm">
			<label>x_low</label>
			<input type="text" name="x_low" id="x_low" value="{{x_low}}"/>
			<label>y_low</label>
			<input type="text" name="y_low" id="y_low" value="{{y_low}}"/>
			<label>x_high</label>
			<input type="text" name="x_high" id="x_high" value="{{x_high}}"/>
			<label>y_high</label>
			<input type="text" name="y_high" id="y_high" value="{{y_high}}"/>
			<button id="changeGraph" type="submit">Zoom button</button>
		</form>
	</div>
	<div id="strafeArrows">
		<button class="strafeArrow" id="strafeLeft">&lArr;</button>
		<button class="strafeArrow" id="strafeRight">&rArr;</button>
		<button class="strafeArrow" id="strafeTop">&uArr;</button>
		<button class="strafeArrow" id="strafeBottom">&dArr;</button>
	</div>
	</div>
	 <script>
	 	/*
	$('#strafeRight').on('click', function() {
	    $(this).css('right', -250);
	    $(this).closest('.sidebar-outer').css('width', 0);
	});*/
    </script>
	<div id="imageClick"></div>
	<script type="text/javascript">
	$(document).ready(function() {
		var canvas = document.getElementById('imageCanvas');
		var ctx = canvas.getContext('2d');
		var domRect = canvas.getBoundingClientRect();
		canvas.width = domRect.width;
		canvas.height = domRect.height;
		var data = {};
		var isDown = false;
		var x_start;
		var y_start;

		//Style the resizing box
		ctx.fillStyle = "rgba(0, 0, 255, 0.5)";
	  	ctx.strokeStyle = "lightgray";
	  	ctx.lineWidth = 3;

		//Update canvas in case of window resize
		$(window).resize(function(){
			var domRect = canvas.getBoundingClientRect();
			canvas.width = domRect.width;
			canvas.height = domRect.height;
			ctx.fillStyle = "rgba(0, 0, 255, 0.5)";
		  	ctx.strokeStyle = "lightgray";
		  	ctx.lineWidth = 3;
		});

		$("#imageCanvas").on("mousemove", function(event){
			if (!isDown) {
		        return;
			}
			mouseX = parseFloat(event.pageX - this.offsetLeft);
		    mouseY = parseFloat(event.pageY - this.offsetTop);
		    ctx.clearRect(0, 0, canvas.width, canvas.height);
		    var width = mouseX - x_start;
		    var height = mouseY - y_start;
		    //console.log(isDown);
		    //console.log(mouseX);
		    //console.log(x_start);
		    //console.log(width);
		    ctx.beginPath();
		    ctx.rect(x_start, y_start, width, height);
		    ctx.fill();
		    ctx.stroke();
		});

	    $("#imageCanvas").on("mousedown", function(event) {
	    	event.preventDefault();
	    	document.getElementById("inputForm").style.display = 'none';
	    	var domRect = this.getBoundingClientRect();
	        var x_down = (event.pageX - this.offsetLeft) / domRect.width;
	        x_start = event.pageX - this.offsetLeft;
	        //console.log(domRect);
	        //console.log(event.pageX);
	        //console.log(this.offsetLeft);
	        //console.log(this.width);
	        var y_down = (event.pageY - this.offsetTop) / domRect.height;
	        y_start = event.pageY - this.offsetTop;
	        //console.log(x_down);
	        //console.log(y_down);

	        data['x_down'] = x_down;
	        data['y_down'] = y_down;
	        isDown = true;
	    });

		$("#imageCanvas").on("mouseup", function(event) {
			var domRect = this.getBoundingClientRect();
		    var x_up = (event.pageX - this.offsetLeft) / domRect.width;
		    var y_up = (event.pageY - this.offsetTop) / domRect.height;
		    console.log("release mouse");
		    //console.log(x_high);
		    //console.log(y_high);

		    data['x_up'] = x_up;
		    data['y_up'] = y_up;
		    isDown = false;
		    ctx.clearRect(0, 0, canvas.width, canvas.height);

		    data["current_x_low"] = $("#x_low").val();
		    data["current_y_low"] = $("#y_low").val();
		    data["current_x_high"] = $("#x_high").val();
		    data["current_y_high"] = $("#y_high").val();

			$.ajax({
			    type: 'POST',
			    url: '/zoom',
			    dataType: 'json',
			    contentType: 'application/json; charset=utf-8',
			    data: JSON.stringify(data),
			    success: function(callback) {
			        // Watch out for Cross Site Scripting security issues when setting dynamic content!
			        console.log("test");
			        document.getElementById("inputForm").style.display = 'block';
					$('#dsImage').attr('src', callback.newImage);
					$('#x_low').val(callback.x_low);
					$('#y_low').val(callback.y_low);
					$('#x_high').val(callback.x_high);
					$('#y_high').val(callback.y_high);
					//console.log(imageObj);
			        //$('#dsImage').attr('src', callback.newImage);;
			    },
			    error: function() {
			        $(this).html("error!");
			    }
			});
	    });
	});
	</script>
	<script type="text/javascript">
        $('#inputForm').submit(function(e) {
                e.preventDefault();

                var data = {};
                var Form = this;

                $.each(this.elements, function(i, v) {
                    var input = $(v);
                    data[input.attr("name")] = input.val();
                    delete data["undefined"];
                });

                $.ajax({
                    type: 'POST',
                    url: '/changeRange',
                    dataType: 'json',
                    contentType: 'application/json; charset=utf-8',
                    data: JSON.stringify(data),
                    context: Form,
                    success: function(callback) {
                        console.log('testing');
                        // Watch out for Cross Site Scripting security issues when setting dynamic content!
                        $('#dsImage').attr('src', callback.newImage);
                    },
                    error: function() {
                        $(this).html("error!");
                    }
                });
            });
    </script>
</body>