<!DOCTYPE html>
<html>
<head>
	<title>GeoJSON Map</title>
<head>
	<link rel='stylesheet' href='https://unpkg.com/leaflet@1.0.3/dist/leaflet.css' integrity='sha512-07I2e+7D8p6he1SIM+1twR5TIrhUQn9+I6yjqD53JQjFiMf8EtC93ty0/5vJTZGF8aAocvHYNEDJajGdNx1IsQ=='
		crossorigin='' />
	<script src='https://unpkg.com/leaflet@1.0.3/dist/leaflet.js' integrity='sha512-A7vV8IFfih/D732iSSKi20u/ooOfj/AGehOKq0f4vLT1Zr2Y+RX7C+w8A1gaSasGtRUZpF/NZgzSAu4/Gc41Lg=='
		crossorigin=''></script>
	<link rel='stylesheet' href='https://unpkg.com/leaflet-draw@1.0.0/dist/leaflet.draw.css' />
	<script src='https://unpkg.com/leaflet-draw@1.0.0/dist/leaflet.draw.js'></script>
</head>
	<style>html, body {
		width: 100%;
		height: 100%;
		margin: 0;
		padding: 0;}
	</style>
	<style>#map{
		position: relative;
		width: 100.0%;
		height: 100.0%;
		left: 0.0%;
		top: 0.0%;
		}
	</style>
</head>
<body>
	<div id='map'></div>
	<script type='text/javascript'>
	// basic map definition and zoom control.
	var map = L.map('map');
	map.setView([-34.9, 150.644], 10);
	L.control.scale().addTo(map);
	// drawing layer
	var drawnItems = L.featureGroup().addTo(map);
	// base map
	var base = L.tileLayer(
		'https://{s}.basemaps.cartocdn.com/light_only_labels/{z}/{x}/{y}{r}.png',
		{maxZoom: 18, attribution:''}
	);
	// satelite
	var landsat = L.tileLayer(
		'https://{s}.tiles.mapbox.com/v4/mapbox.landsat-live/{z}/{x}/{y}.jpg?access_token=pk.eyJ1IjoiZWp0YWxib3QiLCJhIjoiY2ptMHBlOGdjMmZlaTNwb2dwMHE2Mm54NCJ9.xzceVNmAZy49SyFDb3UMaw',
		{ maxZoom: 18, attribution:'' }
	);
	// Topo
	var topo = L.tileLayer(
		'https://{s}.tile.opentopomap.org/{z}/{x}/{y}.png',
		{ maxZoom: 18, attribution:'' }
	);
	// fireTiles
	var fireTiles = L.layerGroup().addTo(map);
			// add a 9 tile grid to symbolize fire risk data (each tile gets its own fire risk score)
		L.polygon([
			[-34.8, 150.5],
			[-34.9, 150.5],
			[-34.9, 150.6],
			[-34.8, 150.6]
			]).bindPopup('Fire Risk = 5').addTo(fireTiles);
		L.polygon([
			[-34.7, 150.4],
			[-34.8, 150.4],
			[-34.8, 150.5],
			[-34.7, 150.5]
			]).bindPopup('FireRisk = 1').addTo(fireTiles);
		L.polygon([
			[-34.7, 150.5],
			[-34.8, 150.5],
			[-34.8, 150.6],
			[-34.7, 150.6]
			]).bindPopup('FireRisk = 2').addTo(fireTiles);
		L.polygon([
			[-34.7, 150.6],
			[-34.8, 150.6],
			[-34.8, 150.7],
			[-34.7, 150.7]
			]).bindPopup('FireRisk = 3').addTo(fireTiles);
		L.polygon([
			[-34.8, 150.6],
			[-34.9, 150.6],
			[-34.9, 150.7],
			[-34.8, 150.7]
			]).bindPopup('FireRisk = 6').addTo(fireTiles);
		L.polygon([
			[-34.9, 150.6],
			[-35, 150.6],
			[-35, 150.7],
			[-34.9, 150.7]
			]).bindPopup('FireRisk = 9').addTo(fireTiles);
		L.polygon([
			[-34.9, 150.5],
			[-35, 150.5],
			[-35, 150.6],
			[-34.9, 150.6]
			]).bindPopup('FireRisk = 8').addTo(fireTiles);
		L.polygon([
			[-34.9, 150.4],
			[-35, 150.4],
			[-35, 150.5],
			[-34.9, 150.5]
			]).bindPopup('FireRisk = 7').addTo(fireTiles);
		L.polygon([
			[-34.8, 150.4],
			[-34.9, 150.4],
			[-34.9, 150.5],
			[-34.8, 150.5]
			]).bindPopup('FireRisk = 4').addTo(fireTiles);
	// Options to toggle between maps added to layers
	L.control.layers(
		{
			'base': base.addTo(map),
			'landsat': landsat.addTo(map),
			'topo': topo.addTo(map)
		},
		{
			'drawlayer': drawnItems,
			'fire tiles': fireTiles
		},
		{position: 'topleft', collapsed: false}
	).addTo(map);
	//Boilerplate to add the layer control.
	map.addControl(new L.Control.Draw({
		edit: {
			featureGroup: drawnItems,
			poly: {
				allowIntersection: false
			}
		},
		draw: {
			polygon: {
				allowIntersection: false,
				showArea: true
			}
		}
	}));
	// Helper function for saving veg score.
	function saveVeg() {
		var newVegScore = document.getElementById('veg_score').value
		var shape_id = document.getElementById('popup_leaflet_id').value
		map._layers[shape_id].feature.properties.vegScore = newVegScore
	}
	// Helper function to update veg scores.
	map.on(L.Draw.Event.CREATED, function(event) {
		var layer = event.layer;
		// add veg score.
		feature = layer.feature = layer.feature || {}; // Initialize feature
		feature.type = feature.type || "Feature"; // Initialize feature.type
		var props = feature.properties = feature.properties || {}; // Initialize feature.properties
		props.vegScore = '10';
		// add click handler that makes popup on each click.
		layer.on('click', function (e) {
			vegScore = e.target.feature.properties.vegScore
			layer.bindPopup("<input id='popup_leaflet_id' style='display:none' value=" + e.target._leaflet_id + ">Veg Score: <input type='text' id='veg_score' value=" + vegScore + "><button onclick='saveVeg()' type='button'>Save</button>")
			layer.openPopup()
		})
		drawnItems.addLayer(layer);
	});
	// gets and stringifies GeoJSON representation of the draw layer
	function button_click() {
		drawn_geojson = drawnItems.toGeoJSON()
		alert('We drew: ' + JSON.stringify(drawn_geojson))
	}
</script>
<button type="button" onclick="button_click()" style="position:fixed; top:0; right: 0; z-index:999">Get GeoJson</button>
</body>
</html>