<head>
	<title>Open Modeling Framework</title>
	<meta charset="utf-8">
	<link href="{{pathPrefix}}/static/omf.css" type="text/css" rel="stylesheet"/>
	<link rel="shortcut icon" href="{{pathPrefix}}/static/favicon.ico">
	
	<style type="text/css">
	/*Styles here*/
				.wrapper{
					float: left;
					width: 50%;
					height: 90%;
					position: relative;
				}
				#feederDiagram{ 
					width: 100%;
					height: 75%;
				}
				#damageSummary{
					width: 100%;
					height: 25%;
				}
				#rdtSummary{
					width: 100%;
					height: 100%;
				}
				#powerflowCheck{
					position: absolute;
					z-index: 10;
					bottom: 0;
					right: 0;
					background-color: red;
				}
	</style>
	{% if modelStatus == "running" %}<meta http-equiv="refresh" content="5"/>{% endif %}
	<!-- Library Imports -->
	<script type="text/javascript" src="{{pathPrefix}}/static/omf.js"></script>
	<script type="text/javascript" src="{{pathPrefix}}/static/jquery-1.9.1.js"></script>
	<!-- Data  Imports -->
	<script>allInputData={% if allInputData %}{{allInputData | safe}}{% else %}null{% endif %}</script>
	<script>allOutputData={% if allOutputData %}{{allOutputData | safe}}{% else %}null{% endif %}</script>
	<script>modelStatus="{{modelStatus}}"</script>
	<script>currentUser="{{datastoreNames.get('currentUser','test')}}"</script>
	<script type="text/javascript">
		function editFeeder(modelName, feederNum) {
			console.log("modelName:",modelName)
			studyUser = allInputData.user
			window.open("/feeder/" + studyUser + "/" + modelName + "/" + feederNum,  "_blank")
		}
	</script>
</head>
<body onload="init()">
	<div id="header">
		<div id="headInnerBlock">
			<div id="menuLeft">
				<a style="color:white" href="/">Open Modeling Framework</a> &#187;&nbsp;&nbsp;Model
				&#8220;<p id="titleText" style="display:inline"></p>&#8221;
			</div>
		</div>
	</div>
	<p class="reportTitle">Model Input</p>
	<div id="input" class="content">
			<form name="inputForm" {% if quickRender %} action="/quickRun/"{% else %} action="/runModel/"{% endif %} onsubmit="event.preventDefault(); return isFormValid();" method="post">
			<div class="shortInput">
				<label>Model Type <a href="https://github.com/dpinney/omf/wiki/Models-~-voltageDrop" target="blank">Help?</a></label>
				<input type="text" id="modelType" name="modelType" value="{{modelName}}" readonly/>
			</div>
			
			<div class="shorterInput">
				<label>Model Name</label>
				<input type="text" id="modelName" name="modelName" pattern="^[\w\s\d\.-]+$" required="required">
			</div>
			
			
			<div class="shorterInput runningInline postRunInline">
				<label>User</label>
				<input type="text" id="user" name="user" readonly/>
			</div>
		
			<div class="runningInline postRunInline shortInput">
				<label>Created</label>
				<input type="text" id="created" name="created" readonly/>
			</div>
			<div class="postRunInline shortInput">
				<label>Run Time</label>
				<input type="text" id="runTime" name="runTime" readonly/>
			</div>
			<div class="shortInput">
				<label>Feeder</label>
				<button id="feederButton" type="button" onclick="javascript:editFeeder(allInputData.modelName,1);" style="display:block;width:125px;">Open Editor</button>
			</div>
	
			
			<div class="wideInput">
				<p class="inputSectionHeader">Financial Specs</p>
			</div>
			<hr>

			<div class="shortInput">
				<label class="tooltip">Line Fixed Cost ($)</label>
				<input type="text" id="lineFixedCost" name="lineFixedCost" value="1000" pattern="^\d">
			</div>
			<div class="shortInput">
				<label class="tooltip">Line Unit Cost ($/ft)</label>
				<input type="text" id="lineUnitCost" name="lineUnitCost" value="-" pattern="^\d">
			</div>
			<div class="shortInput">
				<label class="tooltip">Switch Cost ($)</label>
				<input type="text" id="switchCost" name="switchCost" value="500" pattern="^\d">
			</div>
			<div class="shortInput">
				<label class="tooltip">Hardening Unit Cost ($/ft)</label>
				<input type="text" id="hardeningUnitCost" name="hardeningUnitCost" value="1000" pattern="^\d" >
			</div>
			<div class="shortInput">
				<label class="tooltip">DG Fixed Cost ($)</label>
				<input type="text" id="dgFixedCost" name="dgFixedCost" value="10000" pattern="^\d">
			</div>
			<div class="shortInput">
				<label class="tooltip">DG Unit Cost ($/MW)</label>
				<input type="text" id="dgUnitCost" name="dgUnitCost" value="-" pattern="">
			</div>
			<div class="shortInput">
				<label class="tooltip">Hardening Fixed Cost ($)</label>
				<input type="text" id="hardeningFixedCost" name="hardeningFixedCost" value="-" pattern="^\d" >
			</div>
			<div class="shortInput">
				<label class="tooltip">Max DG Per Generator (MW)</label>
				<input type="text" id="maxDG" name="maxDG" value="10" pattern="^\d">
			</div>
			<div class="shortInput">
				<label class="tooltip">Hardening Candidates</label>
				<input type="text" id="hardeningCandidates" name="hardeningCandidates" value="Line_id1, lineid_2">
			</div>
			<div class="shortInput">
				<label class="tooltip">New Line Candidates</label>
				<input type="text" id="newLineCandidates" name="newLineCandidates" value="(node1,node2)(node3,node4)">
			</div>
			<div class="shortInput">
				<label class="tooltip">Generator Candidates</label>
				<input type="text" id="generatorCandidates" name="generatorCandidates" value="node1">
			</div>

			<div class="wideInput">
				<p class="inputSectionHeader">Simulation Specs</p>
			</div>
			<hr>

			<div class="shortInput">
				<label class="tooltip">Critical Load Met (%)</label>
				<input type="text" id="criticalLoadMet" name="criticalLoadMet" value="75" pattern="">
			</div>
			<div class="shortInput">
				<label class="tooltip">Non-Critical Load Met (%)</label>
				<input type="text" id="nonCriticalLoadMet" name="nonCriticalLoadMet" value="25" pattern="^\d">
			</div>
			<div class="shortInput">
				<label class="tooltip">Chance Constraint (%)</label>
				<input type="text" id="chanceConstraint" name="chanceConstraint" value="50" pattern="^\d{5}">
			</div>
			<div class="shortInput">
				<label class="tooltip">Phase Variation</label>
				<input type="text" id="phaseVariation" name="phaseVariation" value="25.0" pattern="^\d">
			</div>
			<div class="shortInput">
				<label class="tooltip">Weather Impacts (.asc)<span class="classic">Zip code of the planned array's geographical location.</span></label>
				<input type="text" id="zipCode" name="zipCode" value="64735" pattern="^\d{5}(?:[-\s]\d{4})?$" required="required">
			</div>
			<div class="shortInput">
				<label class="tooltip">Pole Data (.json)<span class="classic">Zip code of the planned array's geographical location.</span></label>
				<input type="text" id="zipCode" name="zipCode" value="64735" pattern="^\d{5}(?:[-\s]\d{4})?$" required="required">
			</div>
			<div class="shortInput">
				<label>Simulation Date</label>
				<input type="text" id="simDate" name="simDate" value ="2016-01-01">
			</div>
			<div class="shortInput">
				<label class="tooltip">Zip Code<span class="classic">Zip code of the planned array's geographical location.</span></label>
				<input type="text" id="zipCode" name="zipCode" value="64735" pattern="^\d{5}(?:[-\s]\d{4})?$" required="required">
			</div>

			<div class="wideInput" style="text-align:right">
				{% if not quickRender %}
				<button id="deleteButton" type="button" class="stoppedInline postRunInline" onclick="deleteModel()">Delete</button>
				<button id="publishButton" type="button" class="postRunInline" onclick="publishModel()">Publish</button>
				<button id="duplicateButton" type="button" class="postRunInline" onclick="duplicateModel()">Duplicate</button>
				{% endif %}
				<button id="cancelButton" class="runningInline" type="button" onclick="cancelModel()">Cancel Run</button>
				{% if quickRender %}
				<button id="saveButton" class="postRunInline" style = "background-color: orange;"onclick="event.preventDefault(); return showSaveAlert(window.location.href)">Save</button>
				{% endif %}
				<button id="runButton" type="submit">Run Model</button>
			</div>
		</form>
	</div>
	


<!--  VOLTAGE THINGS, DONT NEED
	<div id ="runIndicator" class="content running">
		Model running on server. Refresh the page to check for results, or wait for automatic refresh every 5 seconds.
	</div>
	<div id ="stopIndicator" class="content stopped" style="visibility: hidden">
		<pre id='errorText'></pre>
		<script type="text/javascript">
		if (typeof(allInputData.stderr) !== 'undefined') {
			gebi('stopIndicator').style.visibility = 'visible'
			gebi('errorText').innerHTML = 'MODEL ENCOUNTERED AN ERROR AS FOLLOWS: \n\n' + allInputData.stderr}
		</script>
	</div>
	<div id="output">
		<p class="reportTitle postRun" style="page-break-before:always">Voltage Drop Diagram</p>
		<div id="voltageDropDiagram" class="tightContent postRun">
			<img id="voltageDropChart" style="width:1000px;height:1000px;" />
			<script type="text/javascript">gebi("voltageDropChart").src = "data:image/png;base64," + allOutputData.voltageDrop</script>
		</div>
	</div>
-->

	<p style="font-size:40pt;text-align:center;margin:10 10 10 10;">RDT-Fragility OMF Integration</p>
	<div class ='wrapper'>
		<div id = "feederDiagram">
			<p style="text-align:center;margin:0 0 -12 0;">Feeder Diagram</p>
			<br>
			<img src="../scratch/LPNORM Integration Code/outData/feederChart.png" alt="Feeder Diagram">
		</div>
		<div id = "damageSummary">
			<p style="text-align:center;margin:0 0 -12 0;">Fragility Input JSON</p>
			<br>
			<iframe style="width:95%;" src="../scratch/LPNORM Integration Code/inData/fragInSimple_Market_System.json"></iframe>
		</div>
	</div>
	<div class="wrapper">
		<div id = "rdtSummary">
			<p style="text-align:center;margin:0 0 -12 0;">RDT Output JSON</p>
			<br>
			<iframe style="width:95%;height:94%;" src="../scratch/LPNORM Integration Code/outData/rdtOutputSimple_Market_System.json"></iframe>
		</div>
		<!--<div id = "powerflowCheck">
			Power Check Failed
		</div>-->
	</div>


</body>