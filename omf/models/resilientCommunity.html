<head>
	{{ omfHeaders }}
	<script src="{{pathPrefix}}/static/highcharts4.src.js"></script>
	<script src="https://cdn.plot.ly/plotly-1.50.1.min.js"></script>
	{% macro insert_file_upload_block(fileName, dataVariableName) -%}
		<input id="{{dataVariableName}}Handler" type="file" style="display:none" onchange="handle_files(this.files,'{{dataVariableName}}','{{fileName}}')">
		<input id="{{dataVariableName}}" name="{{dataVariableName}}" value="{{allInputDataDict[dataVariableName]}}" type="hidden">
		<div>
			<label for="{{dataVariableName}}Handler" class="fileButton">Choose File</label>
			<input id="{{fileName}}" name="{{fileName}}" value="{{allInputDataDict[fileName]}}" readonly class="uploadFileName">    
		</div>
	{%- endmacro %}
</head>
<body>
	{{ omfModelTitle }}
	<p class="reportTitle">Model Input</p>
	<div id="input" class="content">
		<form name="inputForm" action="/runModel/" onsubmit="event.preventDefault(); return isFormValid();" method="post">
			<!-- Required Inputs -->
			<div class="shortInput">
				<label>Model Type <a href="https://github.com/dpinney/omf/wiki/Models-~-resilientCommunity" target="blank">Help?</a></label>
				<input type="text" id="modelType" name="modelType" value="{{modelName}}" readonly/>
			</div>
			<div class="shortInput">
				<label>Model Name</label>
				<input type="text" id="modelName" name="modelName" value="{{allInputDataDict.modelName}}"pattern="^[\w\s\d\.-]+$" required="required">
			</div>
			<div class="shortInput">
				<label>User</label>
				<input type="text" id="user" name="user" value="{{allInputDataDict.user}}"readonly/>
			</div>
			<div class="shortInput">
				<label>Created</label>
				<input type="text" id="created" name="created" value="{{allInputDataDict.created}}"readonly/>
			</div>
			<div class="shortInput">
				<label>Run Time</label>
				<input type="text" id="runTime" name="runTime" value="{{allInputDataDict.runTime}}"readonly/>
			</div>
			<!-- NEW ADDITIONS -->
			<div class="shortInput">
				<label>Feeder</label>
				<button id="feederButton" type="button" onclick="javascript:editFeeder(allInputData.modelName,1);" style="display:block;width:125px;">Open Editor</button>
				<input type="text" id="feederName1" name="feederName1" value="{{allInputDataDict.feederName1}}" style="display:none">
			</div>

			<div class="shortInput">
				<label class="tooltip">Equipment of Interest<span class="classic">Select Equipment of Interest </span></label>
				<br>
				<label>Choose Equipment</label>
				<br>
				<label>Lines</label>
				<select name="lines" id="lines">
					<option value="yes" {% if allInputDataDict.lines | lower == "yes" %}selected{% endif %} >Yes</option>
					<option value="no" {% if allInputDataDict.lines | lower != "yes" %}selected{% endif %}>No</option>
				</select>
			</div>
			<div class="shortInput">
			<label>Transformers</label>
			<select name="transformers" id="transformers">
				<option value="yes" {% if allInputDataDict.transformers | lower == "yes" %}selected{% endif %}>Yes</option>
				<option value="no" {% if allInputDataDict.transformers | lower != "yes" %}selected{% endif %}>No</option>
			</select>
			</div>
			<div class="shortInput">
			<label>Fuses</label>
			<select name="fuses" id="fuses">
				<option value="yes" {% if allInputDataDict.fuses | lower == "yes" %}selected{% endif %}>Yes</option>
				<option value="no" {% if allInputDataDict.fuses | lower != "yes" %}selected{% endif %}>No</option>
			</select>
			</div>
			
			<div class="shortInput">
			<label>Data Refresh</label>
			<select name="refresh" id="refresh">
				<option value="True" {% if allInputDataDict.refresh == True %}selected{% endif %}>Yes</option>
				<option value="False" {% if allInputDataDict.refresh == False %}selected{% endif %}>No</option>
			</select>
			</div>
		
			<div class="shortInput">
				<label class="tooltip">Loads Coloring By<span class="classic">Select the simulation output value that will be used to color the loads in the circuit.</span></label>
				<select id="loadCol" name="loadCol">
					<option value="Base Criticality Score" {% if allInputDataDict.loadCol == "Base Criticality Score" %}selected{% endif %}>Base Criticality Score </option>
					<option value="Community Criticality Score" {% if allInputDataDict.loadCol == "Community Criticality Score" %}selected{% endif %}>Community Criticality Score</option>
					<option value="Base Criticality Index" {% if allInputDataDict.loadCol == "Base Criticality Index" %}selected{% endif %}>Base Criticality Index</option>
					<option value="Community Criticality Index" {% if allInputDataDict.loadCol == "Community Criticality Index" %}selected{% endif %}>Community Criticality Index</option>
					<option value="None" {% if allInputDataDict.loadCol == "None" %}selected{% endif %}>No Node Coloring</option>
				</select>
			</div>
			
			<!-- Model Specific Inputs -->
			<div class="wideInput">
				<p class="inputSectionHeader">System Parameters</p>
			</div>
			
			<div class="shortInput">
				<label class="tooltip">Circuit Data Input File <span class="classic">Import a omd file to map</span></label>
				<div>{{ insert_file_upload_block('inputDataFileName','inputDataFileContent') }}</div>
			</div>
			{{ omfModelButtons }}
		</form>
	</div>
	{{ omfRunDebugBlock }}
	{% if modelStatus == 'finished' %}
		<!-- Output tables, graphs, etc -->
		<p class="reportTitle" style="page-break-before:always">Resilient Community Map</p>
		<div id="resilienceMap" class="tightContent"></div>
		<script>
			var mapContent = allOutputData["resilienceMap"]
			var iframe = document.createElement('iframe');
			iframe.style = 'width:1000px; height:800px; border-radius:8px;'
			//document.getElementById('resilienceMap').innerHTML = '<div class="img-div" style="position:relative;left:0;bottom:-800px;"><img style="position:relative" src="{{allOutputDataDict["legend_path"]}}"></div>';
			//document.getElementById('resilienceMap').innerHTML = '<ul class="legend" style="position:relative;left:0;bottom:-800px;"> <li style="float: left; margin-right: 10px;"><span class="veryhigh" style="background-color: #ff00ff;"></span>Very High</li><li><span class="relativelyhigh" style="background-color: #00ffff;""></span> Relatively High</li><li><span class="relativelymoderate" style="background-color: #0000ff;"></span> Relatively Moderate</li><li><span class="relativelylow" style="background-color: #000000;"></span> Relatively Low</li><li><span class="verylow"></span> Very Low</li><li><span class="dataunavailable"></span> Data Unavailable</li></ul>'
			document.getElementById('resilienceMap').innerHTML = "<div class='my-legend' style='position:relative;left:0;bottom:-800px;'><div class='legend-title' style='position:relative'>Social Vulnerability Legend</div> <div class='legend-scale'> <ul class='legend-labels'> <li><span style='background:#0000FF;'></span>Very High</li> <li><span style='background:#ADD8E6;'></span>Rel. High</li> <li><span style='background:#90EE90;'></span>Rel. Moderate</li> <li><span style='background:#FFFF00;'></span>Rel. Low</li> <li><span style='background:#808080;'></span>Very Low</li> <li><span style='background:#000000;'></span>Data Unavailable </li> </ul> </div> <style type='text/css'> .my-legend .legend-title { text-align: left; margin-bottom: 8px; font-weight: bold; font-size: 90%; } .my-legend .legend-scale ul { margin: 0; padding: 0; float: left; list-style: none; } .my-legend .legend-scale ul li { display: block; float: left; width: 50px; margin-bottom: 6px; text-align: center; font-size: 70%; list-style: none; } .my-legend ul.legend-labels li span { display: block; float: left; height: 15px; width: 50px; } .my-legend .legend-source { font-size: 70%; color: #999; clear: both; } .my-legend a { color: #777; } </style> "
			document.getElementById('resilienceMap').appendChild(iframe);
			iframe.contentWindow.document.open();
			iframe.contentWindow.document.write(mapContent);
			iframe.contentWindow.document.close();
		</script>
</div>


<p class="reportTitle">Objects Data Table</p>
<div id="traditionalObjectsTable" class="tightContent" style="height:300px; overflow-y: scroll;">
	<table style="width:100%">
		<tr>
				{% for header in allOutputDataDict["loadTableHeadings2"] %}
				<th>{{ header }}</th>
				{% endfor %}
		</tr>
		{% for values in allOutputDataDict["loadTableValues2"] %}
		<tr>
				{% for val in values %}
				<td>{{ val }}</td>
				{% endfor %}
		</tr>
		{% endfor %}
</table>
</div>

			{{ rawOutputFiles }}
		</div>
	{% endif %}
</body>
