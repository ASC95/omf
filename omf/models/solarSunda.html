<head>
	<title>Open Modeling Framework</title>
	<meta charset="utf-8">
	<link href="{{pathPrefix}}/static/omf.css" type="text/css" rel="stylesheet"/>
	<link rel="shortcut icon" href="{{pathPrefix}}/static/favicon.ico">
	<link href="{{pathPrefix}}/static/models.css" type="text/css" rel="stylesheet"/>
	<!-- Library Imports -->
	<script type="text/javascript" src="{{pathPrefix}}/static/omf.js"></script>
	<script type="text/javascript" src="{{pathPrefix}}/static/jquery-1.9.1.js"></script>
	<script src="{{pathPrefix}}/static/highcharts4.src.js"></script>
	<script src="{{pathPrefix}}/static/heatmap.src.js"></script>
	<script src="{{pathPrefix}}/static/d3.v3.js"></script>
	<!-- Global Funcs Import -->
	<script type="text/javascript" src="{{pathPrefix}}/static/models.js"></script>
	<!-- Data  Imports -->
	<script>allInputData={% if allInputData %}{{allInputData | safe}}{% else %}null{% endif %}</script>
	<script>allOutputData={% if allOutputData %}{{allOutputData | safe}}{% else %}null{% endif %}</script>
	<script>modelStatus="{{modelStatus}}"</script>
	<script>currentUser="{{datastoreNames.get('currentUser','test')}}"</script>
	<style type="text/css">thead{font-weight:bold} table{width:980px; font-size:10}</style>
</head>
<body onload="init()">
	<div id="title">
		<div id="logoBox"><a href="/">&#10059;</a></div>
		<p id="titleText">New Solar Sunda Model</p>
	</div>
	<p class="reportTitle">Model Description</p>
	<div id="input" class="content">
		<form name="inputForm" action="/runModel/" method="post">
			<div class="shortInput">
				<label>Model Type <a href="https://github.com/dpinney/omf/wiki/Models:-solarSunda">Help?</a> </label>
				<input type="text" id="modelType" name="modelType" value="solarSunda" readonly/>
			</div>
			<div class="shortInput">
				<label>Model Name</label>
				<input type="text" id="modelName" name="modelName" pattern="^[\w\s\d\.-]+$" required="required">
			</div>
			<div class="shortInput runningInline postRunInline">
				<label>User</label>
				<input type="text" id="user" name="user" readonly/>
			</div>
			<div class="shortInput runningInline postRunInline">
				<label>Created</label>
				<input type="text" id="created" name="created" readonly/>
			</div>
			<div class="shortInput postRunInline">
				<label>Run Time</label>
				<input type="text" id="runTime" name="runTime" readonly/>
			</div>
			<div class="wideInput">
				<p class="inputSectionHeader">System and Co-Op Information</p>
			</div>
			<hr>
			<div class="shortInput">
				<label class="tooltip">Zip Code<span class="classic">Zip code of the systems geographical location.</span></label>
				<input type="text" id="zipCode" name="zipCode" value="90210" pattern="^\d{5}(?:[-\s]\d{4})?$" required="required">
			</div>				
			<div class="shortInput">
				<label class="tooltip">Land<span class="classic">Whether the land is owned, purchased or leased.</span></label>
				<select id="landOwnership" name="landOwnership">
					<option value="Owned">Owned</option>
					<option value="Purchased">Purchased</option>
					<option value="Leased">Leased</option>
				</select>
			</div>
			<div class="shortInput">
				<label class="tooltip">Cost/Acre ($/acre)<span class="classic">Cost of land per acre.</span></label>
				<input type="text" id="costAcre" name="costAcre" value="10000" pattern="^\d+\.?\d*$" required="required">
			</div>		
			<!--Size between 250 - 5000-->		
			<div class="shortInput">
				<label class="tooltip">Array Size (kW-AC)<span class="classic">Size of the solar array kW-AC.</span></label>
				<input type="text" id="systemSize" name="systemSize" value="1000" required="required" pattern="^\d+\.?\d*?$">
			</div>				
			<div class="shortInput">
				<label class="tooltip">Module Cost ($/Wp)<span class="classic">Cost per watt.</span></label>
				<input type="text" id="moduleCost" name="moduleCost" value="0.70" pattern="^\d+\.?\d*$" required="required">
			</div>
			<div class="shortInput">
				<label class="tooltip">Racking Cost ($/Wp)<span class="classic">Cost per watt.</span></label>
				<input type="text" id="rackCost" name="rackCost" value="0.137" pattern="^\d+\.?\d*$" required="required">
			</div>
			<div class="shortInput">
				<label class="tooltip">Inverter Unit Cost ($)<span class="classic">Cost for inverters: will be set to $61,963 if the array size is less than 250kW-AC, and $107,000 if greater than 250kW-AC.</span></label>
				<input type="text" id="inverterCost" name="inverterCost" value="61963" pattern="^\d+\.?\d*$" required="required" readonly="true">
				<script type="text/javascript">
				$("#inverterCost").attr("value", allInputData.inverterCost)			
				</script>	
			</div>
			<div class="shortInput">
				<label class="tooltip">Mechanical Labor ($/hr)<span class="classic">Hourly labor cost.</span></label>
				<input type="text" id="mechLabor" name="mechLabor" value="35" pattern="^\d+\.?\d*$" required="required">
			</div>
			<div class="shortInput">
				<label class="tooltip">Electrical Labor ($/hr)<span class="classic">Hourly labor cost.</span></label>
				<input type="text" id="elecLabor" name="elecLabor" value="50" pattern="^\d+\.?\d*$" required="required">
			</div>						
			<div class="shortInput">
				<label class="tooltip">Project Management Cost ($)<span class="classic">Covers the cost for co-op time and expense in doing the project.</span></label>
				<input type="text" id="pmCost" name="pmCost" value="15000" pattern="^\d+\.?\d*$" required="required">
			</div>
			<div class="shortInput">
				<label class="tooltip">Interconnect Costs ($)<span class="classic">Costs for connecting from the transformer to the substation.</span></label>
				<input type="text" id="interCost" name="interCost" value="25000" pattern="^\d+\.?\d*$" required="required">
			</div>		
			<div class="shortInput">
				<label class="tooltip">Development Costs (%)<span class="classic">The cost for development as a percent.</span></label>
				<input type="text" id="devCost" name="devCost" value="2" pattern="^(100|\d\d|\d)(\.\d+)?$" required="required">
			</div>								
			<div class="shortInput">
				<label class="tooltip">EPC Markup (%)<span class="classic">EPC Markup percentage.</span></label>
				<input type="text" id="EPCRate" name="EPCRate" pattern="^(100|\d\d|\d)(\.\d+)?$" value="3" required="required"/>
			</div>						
			<div class="shortInput">
				<label class="tooltip">Distribution Adder ($/kWH)<span class="classic">Provides comparison for existing PV rate to existing retail rate. </span></label>
				<input type="text" id="distAdder" name="distAdder" value="0" pattern="^\d+\.?\d*$" required="required">
			</div>	
			<div class="wideInput">
				<p class="inputSectionHeader">Financing Information</p>
			</div>
			<hr>
			<div class="shortInput">
				<label class="tooltip">Discount Rate (%)<span class="classic">Loan discount rate.</span></label>
				<input type="text" id="discRate" name="discRate" value="2.32" pattern="^(100|\d\d|\d)(\.\d+)?$" required="required"/>
			</div>						
			<div class="shortInput">
				<label class="tooltip">Loan Interest Rate (%)<span class="classic">Loan discount rate.</span></label>
				<input type="text" id="loanRate" name="loanRate" value="2.00" pattern="^(100|\d\d|\d)(\.\d+)?$" required="required"/>
			</div>							
			<div class="shortInput">
				<label class="tooltip">NCREB Tax Credit Rate (%)<span class="classic">Loan discount rate.</span></label>
				<input type="text" id="NCREBRate" name="NCREBRate" value="4.06" pattern="^(100|\d\d|\d)(\.\d+)?$" required="required"/>
			</div>
			<div class="shortInput">
				<label class="tooltip">Tax Lease Rate (%)<span class="classic">Loan discount rate.</span></label>
				<input type="text" id="taxLeaseRate" name="taxLeaseRate" value="7.20" pattern="^(100|\d\d|\d)(\.\d+)?$" required="required"/>
			</div>							
			<div class="shortInput">
				<label class="tooltip">Targeted Tax Equity Return (%)<span class="classic">Loan discount rate.</span></label>
				<input type="text" id="taxEquityReturn" name="taxEquityReturn" value="8.50" pattern="^(100|\d\d|\d)(\.\d+)?$" required="required"/>
			</div>		
			<div class="wideInput">
				<p class="inputSectionHeader">PPA Information</p>
			</div>
			<hr>
			<div class="shortInput">
				<label class="tooltip">First year energy cost ($/MWh)<span class="classic">Loan discount rate.</span></label>
				<input type="text" id="firstYearEnergyCostPPA" name="firstYearEnergyCostPPA" value="55" pattern="^\d+\.?\d*?$" required="required"/>
			</div>						
			<div class="shortInput">
				<label class="tooltip">Annual Escalation Rate<span class="classic">Loan discount rate.</span></label>
				<input type="text" id="annualEscRatePPA" name="annualEscRatePPA" value="2.00" pattern="^(100|\d\d|\d)(\.\d+)?$" required="required"/>
			</div>												
			<div class="wideInput">
				<p class="inputSectionHeader">Simulation Parameters </p>
			</div>
			<hr>								
			<div class="shortInput">
				<label class="tooltip">Simulation Length<span class="classic">Currently we only support a yearlong analysis, i.e. 8760 hours.</span></label>
				<input type="text" id="simLength" name="simLength" pattern="^\d+$" value="8760" readonly />
			</div>
			<div class="shortInput">
				<label>Length Units</label>
				<select id="simLengthUnits" name="simLengthUnits" disabled="true">
					<option value="minutes">Minutes</option> 
					<option value="hours" selected>Hours</option>
					<option value="days">Days</option>
				</select>
			</div>
			<div class="shortInput">
				<label class="tooltip">Simulation Start Date (YYYY-MM-DD)<span class="classic">Currently we only support a yearlong analysis starting on 1 Jan; the year has no effect on the results.</span></label>
				<input type="text" id="simStartDate" name="simStartDate" pattern="^\d\d\d\d-\d\d-\d\d$" value="2014-01-01" readonly/>
			</div>
			<div class="wideInput" style="text-align:right">
				<!--
				<a id="downloadLink" type="button" class="stoppedInline postRunInline" href="#" download>Download Excel</a>
				<script type="text/javascript">
					$("#downloadLink").attr("href", "/downloadModelData/"+allInputData.user+"/"+allInputData.modelName+"/"+allOutputData.excel)
				</script>
				-->
				<button id="deleteButton" type="button" class="stoppedInline postRunInline" onclick="deleteModel()">Delete</button>
				<button id="publishButton" type="button" class="postRunInline" onclick="publishModel()">Publish</button>
				<button id="duplicateButton" type="button" class="postRunInline" onclick="duplicateModel()">Duplicate</button>
				<button id="runButton" type="submit" class="preRun">Run Model</button>
				<button id="rerunButton" type="submit" class="stoppedInline postRunInline">Re-Run Model</button>
			</div>
		</form>
	</div>
	<div id ="runIndicator" class="content running">
		Model running on server. Refresh the page to check for results.
	</div>
	<div id ="stopIndicator" class="content stopped">
		<p>Model cancelled or encountered an error. Please change inputs and re-run.</p>
		<pre id='errorText'></pre>
		<script type="text/javascript">if (typeof(allInputData.stderr) !== 'undefined') {gebi('errorText').innerHTML = '\nFULL ERROR TEXT FOLLOWS\n' + allInputData.stderr}</script>
	</div>
	<div id="output">
		<script id="globalOutputScripting">
			Highcharts.setOptions({global: { useUTC: false }})
			var diff = Date.parse(allOutputData.timeStamps[0].substr(0,19)) - Date.parse(allOutputData.timeStamps[0])
			pointStart = Date.parse(allOutputData.timeStamps[0]) + diff
			pointInterval = Date.parse(allOutputData.timeStamps[1]) - Date.parse(allOutputData.timeStamps[0])
			function insertMetric(tableId, name, vector) {
				// Add a vector to a table as a row.
				table = gebi(tableId)
				newRow = table.insertRow()
				newRow.insertCell().innerHTML = name
				for (i=0; i<vector.length; i++) {
					cell = newRow.insertCell()
					cell.innerHTML = delimitNumbers(vector[i].toFixed(0))
				}
			}
		</script>
		<!--Output-->
		<!--Output Graphs-->
		<p class="reportTitle postRun">Total System and Levelized Costs Breakdown</p>
		<div id="studyDetails" class="tightContent postRun detailsContainer">
			<div id="comparisonPieChart" style="display:inline-block"></div>
			<script>
				new Highcharts.Chart({credits:{enabled:false},
						title: {text: 'SUNDA PV System Cost for 1.4 MWp/1.0 MW-AC Design'},
						series: [{type: "pie", name:"% of Total Cost", data:allOutputData.costsPieChart}],
						tooltip: {pointFormat: '{series.name}: <b>{point.percentage:.1f}%</b>'},
						chart:{"marginBottom":40,"zoomType":"disabled","renderTo":"comparisonPieChart","type":"column","marginRight":20,"marginBottom":70,"height":400,"width":490,"backgroundColor":null},
						plotOptions: {
							pie: {dataLabels: {enabled:false, style:{color: (Highcharts.theme && Highcharts.theme.contrastTextColor) || 'black'}, connectorColor: 'silver'}, showInLegend:true}}})
			</script>
			<div id="monthlyPerformanceDiv" style="display:inline-block"></div>
			<script>
				new Highcharts.Chart({"credits":{"enabled":false},
					"plotOptions":{"column":{"pointPadding":0.2,"borderWidth":0},"series":{"animation":false,"shadow":false},"line":{"marker":{"enabled":false}}},
					"xAxis":{"type":"category","tickColor":"gray","lineColor":"gray","crosshair":true},
					"title":{"text":"Levelized Costs"},
					"series":[{"color":"green", "data":allOutputData.LevelizedCosts, "dataLabels":{"enabled":false}}],
					"yAxis":{"title":{"text":"Cost ($)","style":{"color":"black"}}},
					"chart":{"marginBottom":40,"zoomType":"disabled","renderTo":"monthlyPerformanceDiv","type":"column","marginRight":20,"marginBottom":70,"height":400,"width":490,"backgroundColor":null},
					"tooltip":{"valueDecimals":1},
					"legend":false})
			</script>
		</div>
		<!-- Summary of Results -->
		<!-- Add everything on output page; Could add a cost to payback -->
		<p class="reportTitle postRun">Summary of Financial Analysis:</p>
		<div id="input" class="content postRun">
			<form name="inputForm" action="/runModel/" method="post">
				<p class="inputSectionHeader">Cooperative: XYZ, EC	 </p>
				<br></br>
				<div class="shortInput">
					<reportLabel>Installed System Cost: </reportLabel>
					<input type="text" id="totalCost" name = "totalCost" readonly out/>
				</div>		
				<div class="shortInput">
					<reportLabel>$/Wdc Installed: </reportLabel>
					<input type="text" id="costWdc" name = "costWdc" readonly out/>
				</div>		
				<div class="shortInput">
					<reportLabel>Capacity Factor: </reportLabel>
					<input type="text" id="capFactor" name = "capFactor" readonly out/>
				</div>
				<div class="shortInput">
					<reportLabel>Annual System Output (MWh-AC):</reportLabel>
					<input type="text" id="1yearMWH" name = "1yearMWH" readonly out/>
				</div>																
				<div class="shortInput">
					<reportLabel>Climate Data Selected:</reportLabel>
					<input type="text" id="climSource" name = "climSource" readonly out/>
				</div>															
				<!-- Direct Loan-->	
				<hr>							
				<p class="inputSectionHeader">Direct Loan</p>
				<br></br>
				<div class="shortInput">
					<reportLabel>Levelized Cost of Energy: ($/MWh)</reportLabel>
					<input type="text" id="levelCostDirect" name = "levelCostDirect" value="N/A" readonly out/>
				</div>	
				<br>
				<div class="shortInput">
					<reportLabel>Community Solar Project</reportLabel>
					<input type="text" id="communitySolarProject" name = "communitySolarProject" value="" readonly out/>
				</div>				                		
				<div class="shortInput">
					<label>Cost per Panel (prepay):</label>
					<input type="text" id="costPanelDirect" name = "costPanelDirect" value="N/A" readonly out/>
				</div>	
				<div class="shortInput">
					<label>Cost per 10W of Panel (prepay):</label>
					<input type="text" id="cost10WPanelDirect" name = "cost10WPanelDirect" value="N/A" readonly out/>
				</div>	
				<!-- NCREBs Financing -->	
				<hr>							
				<p class="inputSectionHeader">NCREBs Financing</p>
				<br></br>
				<div class="shortInput">
					<reportLabel>Levelized Cost of Energy: ($/MWh)</reportLabel>
					<input type="text" id="levelCostNCREB" name = "levelCostNCREB" value="N/A" readonly out/>
				</div>	
				<br>
				<div class="shortInput">
					<reportLabel>Community Solar Project</reportLabel>
					<input type="text" id="communitySolarProject" name = "communitySolarProject" value="" readonly out/>
				</div>				                		
				<div class="shortInput">
					<label>Cost per Panel (prepay):</label>
					<input type="text" id="costPanelNCREB" name = "costPanelNCREB" value="N/A" readonly out/>
				</div>	
				<div class="shortInput">
					<label>Cost per 10W of Panel (prepay):</label>
					<input type="text" id="cost10WPanelNCREB" name = "cost10WPanelNCREB" value="N/A" readonly out/>
				</div>		
				<!-- Tax Lease Financing -->	
				<hr>							
				<p class="inputSectionHeader">Tax Lease Structure</p>
				<br></br>
				<div class="shortInput">
					<reportLabel>Levelized Cost of Energy: ($/MWh)</reportLabel>
					<input type="text" id="levelCostTaxLease" name = "levelCostTaxLease" value="N/A" readonly out/>
				</div>	
				<br>
				<div class="shortInput">
					<reportLabel>Community Solar Project</reportLabel>
					<input type="text" id="communitySolarProject" name = "communitySolarProject" value="" readonly out/>
				</div>				                		
				<div class="shortInput">
					<label>Cost per Panel (prepay):</label>
					<input type="text" id="costPanelTaxLease" name = "costPanelTaxLease" value="N/A" readonly out/>
				</div>	
				<div class="shortInput">
					<label>Cost per 10W of Panel (prepay):</label>
					<input type="text" id="cost10WPanelTaxLease" name = "cost10WPanelTaxLease" value="N/A" readonly out/>
				</div>								
				<!-- Tax Equity Flip -->
				<hr>								
				<p class="inputSectionHeader">Tax Equity Flip Structure</p>
				<br></br>
				<div class="shortInput">
					<reportLabel>Levelized Cost of Energy: ($/MWh)</reportLabel>
					<input type="text" id="levelCostTaxEquity" name = "levelCostTaxEquity" value="N/A" readonly out/>
				</div>	
				<br>
				<div class="shortInput">
					<reportLabel>Community Solar Project</reportLabel>
					<input type="text" id="communitySolarProject" name = "communitySolarProject" value="" readonly out/>
				</div>				                		
				<div class="shortInput">
					<label>Cost per Panel (prepay):</label>
					<input type="text" id="costPanelTaxEquity" name = "costPanelTaxEquity" value="N/A" readonly out/>
				</div>	
				<div class="shortInput">
					<label>Cost per 10W of Panel (prepay):</label>
					<input type="text" id="cost10WPanelTaxEquity" name = "cost10WPanelTaxEquity" value="N/A" readonly out/>
				</div>	
				<!-- PPA Comparison -->
				<hr>								
				<p class="inputSectionHeader">PPA Comparison</p>
				<br></br>
				<div class="shortInput">
					<reportLabel>Levelized Cost of Energy: ($/MWh)</reportLabel>
					<input type="text" id="levelCostPPA" name = "levelCostPPA" value="N/A" readonly out/>
				</div>	
				<br>
				<div class="shortInput">
					<reportLabel>First Year Cost/kWh:</reportLabel>
					<input type="text" id="firstYearCostKWhPPA" name = "firstYearCostKWhPPA" value="N/A" readonly out/>
				</div>				                			
				<br>
				<div class="shortInput">
					<reportLabel>Yearly Escalation:</reportLabel>
					<input type="text" id="yearlyEscalationPPA" name = "yearlyEscalationPPA" value="N/A" readonly out/>
				</div>				                			
				<br>					
				<!--Loan PPAs and System Size
				<div class="shortInput">
					<reportLabel>PPA Equivalent: </reportLabel> 
					<input type="text" id="PPANCREB" name = "PPANCREB" value="N/A" readonly out/>
				</div>					
				<div class="shortInput">
					<reportLabel>PPA Equivalent: </reportLabel> 
					<input type="text" id="PPADirect" name = "PPADirect" value="N/A" readonly out/>
				</div>									
				<div class="shortInput">
					<reportLabel>PPA Equivalent: </reportLabel> 
					<input type="text" id="PPATaxEquity" name = "PPATaxEquity" value="N/A" readonly out/>
				</div>													
				<div class="shortInput">
					<label>System Size (kWp-DC): </label>
					<input type="text" id="sysSize" name = "sysSize" value="N/A" readonly out/>			
				</div>	
				-->
				<!--Potential Double Column Layout
				<hr>								
				<p class="inputSectionHeader">Tax Equity Flip Structure</p>
				<br></br>
				<div class="shortInput">
					<reportLabel>Levelized Cost of Energy: ($/MWh)</reportLabel>
					<input type="text" id="levelCostTaxEquity" name = "levelCostTaxEquity" value="N/A" readonly out/>
				</div>	
				<br>
				<div class="shortInput">
					<reportLabel>Community Solar Project</reportLabel>
					<br><br><label>Cost per Panel (prepay):</label>
					<input type="text" id="costPanelTaxEquity" name = "costPanelTaxEquity" value="" readonly out/>
					<br><br><label>Cost per 10W of Panel (prepay):</label>
					<input type="text" id="cost10WPanelTaxEquity" name = "cost10WPanelTaxEquity" value="N/A" readonly out/>					
				</div>
				<br>			    
				-->

				<!-- Set Values -->	
				<script type="text/javascript">
				$("#climSource").attr("value", allInputData.climateName)	
				$("#1yearMWH").attr("value", delimitNumbers((parseFloat(allOutputData.oneYearGenerationWh)/1000000).toFixed(0))) 	
				$("#totalCost").attr("value", "$" + delimitNumbers(parseFloat(allOutputData.totalCost).toFixed(0)))
				$("#costWdc").attr("value", "$" + delimitNumbers(parseFloat(allOutputData.costWdc).toFixed(2)))			
				$("#capFactor").attr("value", delimitNumbers(parseFloat(allOutputData.capFactor).toFixed(0)) +  "%")	
				$("#levelCostDirect").attr("value", "$" + delimitNumbers(parseFloat(allOutputData.levelCostDirect).toFixed(2)))	
				$("#costPanelDirect").attr("value", "$" + delimitNumbers(parseFloat(allOutputData.costPanelDirect).toFixed(2)))		
				$("#cost10WPanelDirect").attr("value", "$" + delimitNumbers(parseFloat(allOutputData.cost10WPanelDirect).toFixed(2)))
				$("#levelCostNCREB").attr("value", "$" + delimitNumbers(parseFloat(allOutputData.levelCostNCREB).toFixed(2)))	
				$("#costPanelNCREB").attr("value", "$" + delimitNumbers(parseFloat(allOutputData.costPanelNCREB).toFixed(2)))		
				$("#cost10WPanelNCREB").attr("value", "$" + delimitNumbers(parseFloat(allOutputData.cost10WPanelNCREB).toFixed(2)))
				$("#PPANCREB").attr("value", "$" + delimitNumbers(parseFloat(allOutputData.PPANCREB).toFixed(2)))		
				$("#levelCostTaxLease").attr("value", "$" + delimitNumbers(parseFloat(allOutputData.levelCostTaxLease).toFixed(2)))	
				$("#costPanelTaxLease").attr("value", "$" + delimitNumbers(parseFloat(allOutputData.costPanelTaxLease).toFixed(2)))		
				$("#cost10WPanelTaxLease").attr("value", "$" + delimitNumbers(parseFloat(allOutputData.cost10WPanelTaxLease).toFixed(2)))	
				$("#levelCostTaxEquity").attr("value", "$" + delimitNumbers(parseFloat(allOutputData.levelCostTaxEquity).toFixed(2)))
				$("#costPanelTaxEquity").attr("value", "$" + delimitNumbers(parseFloat(allOutputData.costPanelTaxEquity).toFixed(2)))		
				$("#cost10WPanelTaxEquity").attr("value", "$" + delimitNumbers(parseFloat(allOutputData.cost10WPanelTaxEquity).toFixed(2)))
				$("#levelCostPPA").attr("value", "$" + delimitNumbers(parseFloat(allOutputData.levelCostPPA).toFixed(2)))	
				$("#firstYearCostKWhPPA").attr("value", "$" + delimitNumbers(parseFloat(allOutputData.firstYearCostKWhPPA).toFixed(2)))			
				$("#yearlyEscalationPPA").attr("value", delimitNumbers(parseFloat(allOutputData.yearlyEscalationPPA).toFixed(0)) + "%")										
				</script>			
			</form>
		</div>
		<p class="reportTitle postRun">Simulation Location
		</p>
		<div id="studyDetail" class="tightContent postRun detailsContainer" style="position: relative">
			<div id="mapHere">
				<script type="text/javascript">
					var width = 1000,
						height = 350;

					var projection = d3.geo.albersUsa().scale(600).translate([width/2, height/2]);

					var path = d3.geo.path()
						.projection(projection);

					var svg = d3.select("#mapHere").append("svg")
						.attr("width", width)
						.attr("height", height);

					var group = svg.append("g");

					group.attr("transorm", "scale(.2, .2)");
					d3.json('/static/state_boundaries.json', function(collection) {
						group.selectAll('path')
							.data(collection.features)
							.enter().append('path')
							.attr('d', d3.geo.path().projection(projection))
							.attr('id', function(d){return d.properties.name.replace(/\s+/g, '')})
							.style('fill', 'gray')
							.style('stroke', 'white')
							.style('stroke-width', 1);
					});

					d3.json("{{pathPrefix}}/static/city_locations.json", function(new_us_places){
						climate = allInputData.climateName
						var ST_NAME = climate.split("-");
						var ST = ST_NAME[0], NAME = ST_NAME[1];
						var my_coords = projection(new_us_places[ST][NAME]);
						var r = 5;
						circle = svg.append("circle")
							.attr("cx", my_coords[0])
							.attr("cy", my_coords[1])
							.attr("r", 5)
							.attr("class", "HighlightCircle")
						circle.append("svg:title").text(climate);
					})
				</script>
			</div>
		</div>	
</body>