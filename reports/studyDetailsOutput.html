<p class="reportTitle">Study Details</p>

<div id="studyDetails" class="detailsContainer tightContent" style="padding:10px;position:relative;">
  <style type="text/css" scoped>
		table#detailsTable th, td {
		    /* text-align:left; */
		    text-align: center;
		    /* // border:1px solid black; */
		    padding:5px;
		    vertical-align:top;
		}
		#stnames{
		    text-align:left;
		}
		
		/* #comparisonPieChart{ */
		/*     min-width:400px; */
		/*     min-height:200px; */
		/*     /\* margin: -10; *\/ */
		/*     /\* vertical-align:top; *\/ */
		/* } */
		.HighlightCircle{
		    fill: rgb(16, 150, 24);
		}
		#states{
		    fill: #aaa;
		    stroke: #fff;
		    stroke-width: 1.5px;
		}
		.cont{
		    /* position:absolute; */
		    /* top:-20; */
		    /* left:-100; */
		}
		#mapHere{
		    /* position:relative; */
		    /* left:50%; */
		    height:100%;
		    width:100%;
		}
		#studies{
		    text-align: center;
		}
  </style>
  <script>daClimates={{climates | safe}}</script>
  <table id="detailsTable">
    
    <tr>
      <th class="hozHead">Analysis Creation Date</th>
      <th id="SL">Simulation Location</th>
    </tr>
    
    <tr>
      <td>{{ ana.created }}</td>
      <td rowspan="7" style="width:100%">
	<div id="mapHere">
	</div>
      </td>
    </tr>
    
    <tr>
      <th class="hozHead">Simulation Length</th>
    </tr>
    
    <tr>
      <td class="hozHead">{{ ana.simLength }} {{ ana.simLengthUnits }}</td>
    </tr>
    
    <tr>
      <th>Grid Components</th>
    </tr>
    
    <tr>
      <td id="GC">
	<div id="comparisonPieChart" style="min-width: 400px; height: 200px; margin: 0 auto">
	</div>
      </td>
    </tr>
    
    <tr>
      <th id="studies">Studies</th>
    </tr>
    
    <tr>
      <td>
	<div id="stnames">
	  {%- for study in outputList -%}
	  <span>{{ study.studyName }} - <a href="/analysisFeeder/{{ana.name}}/{{study.studyName}}">{{study.sourceFeederName}}</a></span><br />
	  {%- endfor -%}
	</div>
      </td>
    </tr>
    
  </table>
</div>

<script src="/static/d3.v3.js"></script>
<script type="text/javascript">
	$(function(){
	    $("#comparisonPieChart").highcharts({
		credits:{
		    enabled:false
		},
		title: {
		    text: ''
		},
		series: [{
		    type: "pie",
		    data: {{ pieChartData }}.splice(1),
		}],
		plotOptions: {
		    pie: {
			dataLabels: {
			    enabled: false,
			}
		    }
		}
	    });

	    // $(document).on("click", "#detailsTable a", function(e){
	    // 	window.location = $(this).attr("href");
	    // });
	});

var width = $("#mapHere").width(), height=450;

// var width = 1000, height = 1000;
// $("#mapHere")
// 	.css("width", width-300)
// 	.css("height", height-400);

var sf = 0.7;
var projection = d3.geo.albers()
	.scale(sf*1000)
	.center([17,40]);

	
var path = d3.geo.path()
	.projection(projection)
	.pointRadius(2);

var svg = d3.select("#mapHere").append("svg")
	.attr("width", width)
	.attr("height", height)
	.attr("class", "cont");

var g = svg.append("g")
	.attr("id", "states");



var ak_transform = "translate("+300*sf+","+sf*175+") scale(0.5)"; // scale(0.75) rotate(-30)";
var hi_transform = "translate("+sf*1950+","+sf*-950+") scale(2.75)"; //

d3.json("/static/state_boundaries.json", function(json){
    g.selectAll("path")
	    .data(json.features)
	    .enter().append("path")
	    .attr("d", path)
	    .attr("transform", function(d){
		if(d.properties.name == "Alaska")
		    return ak_transform;
		else if(d.properties.name == "Hawaii")
		    return hi_transform;
		// return "translate(0, 0)";
	    })

})

d3.json("/static/city_locations.json", function(new_us_places){
    daClimates.splice(1).forEach(function(climate){
	var ST_NAME = climate[0].split("-");
	var ST = ST_NAME[0], NAME = ST_NAME[1];
	var my_coords = projection(new_us_places[ST][NAME]);
	var r = 5;
	svg.append("circle")
		.attr("cx", my_coords[0])
		.attr("cy", my_coords[1])
		.attr("r", function(){
		    if (ST == "AK") return r * 1/0.5;
		    else if (ST == "HI") return r* 1/2.75;
		    return r;
		})
		.attr("class", "HighlightCircle")
		.attr("transform", function(){
		    if (ST == "AK") return ak_transform;
		    else if (ST == "HI") return hi_transform;
		    // return "translate(0, 0)";
		})
		// .scale(function(){
		//     if (ST == "AK") return 100;
		//     return 1000;
		// })
    })
})

</script>
