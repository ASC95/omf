<p class="reportTitle">Cost Benefit Analysis</p>
<div id="monetizationReport" class="tightContent" style="position:relative;height:400px">
	<div id="monetizedPowerTimeSeries" style="position:absolute;top:0px;left:0px;width:500px;height:200px">
		<script>monCapCostGraph = new Highcharts.Chart({{ monPowGraphParams }})</script>
	</div>
	<div id="monetizedEnergyBalance" style="position:absolute;top:0px;left:500px;width:500px;height:200px">
		<script>monEnergyCostGraph = new Highcharts.Chart({{ monEnergyGraphParams }})</script>
	</div>
	<div id="additionalMetrics" style="position:absolute;top:210px;left:10px;width:1000px;height:190px;overflow-y:auto;overflow-x:hidden">
		<div style="width:1000px;height:40px;padding:0px 5px 0px 5px">
				Co-op Energy Rate ($/kWh) <input id="distrEnergyRate" value="{{distrEnergyRate}}"/> Capacity Rate ($/kW) <input id="distrCapacityRate" value="{{distrCapacityRate}}"/><button style="width:100px" onclick="recalculateCostBenefit()">Recalculate</button>
		</div>
		<table style="width:980px">
			<thead>
				<tr><th>Study</th><th>Baseline</th><th>Capital Cost</th><th>O&amp;M Cost</th><th>Capacity Cost</th><th>Energy Cost</th><th>Delta Cost</th><th>C/B</th></tr>
			</thead>
			<tbody id="additionalMetricsTable">
				{%- for study in studyList -%}
				<tr><td class="studyName">{{ study.name }}</td>
					<td><input type="radio" name="baseline" class="baseline" {% if study.firstStudy %}checked{% endif %}/></td>
					<td><input class="capCost" value="{{ study.equipAndInstallCost}}"/></td>
					<td><input class="omCost" value="{{ study.opAndMaintCost}}"/></td>
					<td class="capacityCost">calcMe</td>
					<td class="enerCost">calcMe</td>
					<td class="NPV">calcMe</td>
					<td class="costBen">calcMe</td>
				</tr>
				{%- endfor -%}
			</tbody>
		</table>
		<script>
			energyTotals = {{ energyTotals }}
			capTotals = {{ capTotals }}

			function recalculateCostBenefit() {
				baseCost = 0
				energyRate = parseFloat(gebi('distrEnergyRate').value)
				capRate = parseFloat(gebi('distrCapacityRate').value)
				tableRows = gebi('additionalMetricsTable').childNodes
				totalRows = tableRows.length
				for (rowNum=0;rowNum<totalRows;rowNum++) {
					daRow = tableRows[rowNum]
					studyName = daRow.querySelector('.studyName').innerHTML
					isBaseline = daRow.querySelector('.baseline').checked
					capacityCost = parseFloat((capRate * capTotals[studyName]).toPrecision(4))
					daRow.querySelector('.capacityCost').innerHTML = capacityCost
					enerCost = parseFloat((energyRate * energyTotals[studyName]).toPrecision(4))
					daRow.querySelector('.enerCost').innerHTML = enerCost
					if (isBaseline) {
						daRow.querySelector('.NPV').innerHTML = '0'
						daRow.querySelector('.costBen').innerHTML = 'N/A'
						capCost = parseFloat(daRow.querySelector('.capCost').value)
						omCost = parseFloat(daRow.querySelector('.omCost').value)
						baseCost = capCost + omCost + enerCost + capacityCost
					}
				}
				for (rowNum=0;rowNum<totalRows;rowNum++) {
					daRow = tableRows[rowNum]
					isBaseline = daRow.querySelector('.baseline').checked
					if (!isBaseline) {
						capacityCost = parseFloat(daRow.querySelector('.capacityCost').innerHTML)
						enerCost = parseFloat(daRow.querySelector('.enerCost').innerHTML)
						capCost = parseFloat(daRow.querySelector('.capCost').value)
						omCost = parseFloat(daRow.querySelector('.omCost').value)
						thisRowCost = capacityCost + enerCost + capCost + omCost
						NPV = baseCost - thisRowCost
						daRow.querySelector('.NPV').innerHTML = NPV
						daRow.querySelector('.costBen').innerHTML = (thisRowCost/NPV).toPrecision(4)
					}
				}
			}

			recalculateCostBenefit()
		</script>
	</div>
</div>